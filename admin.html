<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>운행 거리 관리자</title>
<link rel="stylesheet" href="style.css">
<script type="module">
import { pushData } from './src/main.js';

async function submit(e) {
  e.preventDefault();
  const lat = parseFloat(document.getElementById('lat').value);
  const lng = parseFloat(document.getElementById('lng').value);

  await pushData({ lat, lng, timestamp: Date.now() });
  alert('업데이트 완료!');
}
</script>
</head>
<body>
<h1>운행 거리 관리자</h1>

<form onsubmit="submit(event)">
  <label>위도: <input id="lat" type="number" step="0.000001" required></label><br>
  <label>경도: <input id="lng" type="number" step="0.000001" required></label><br>
  <button type="submit">업로드</button>
</form>

<hr>
<h2>현재 거리 (미터)</h2>
<div id="dist"></div>

<script>
// 간단한 주행거리 계산(실제 로직은 필요에 따라 바꿔주세요)
let prev = null;
setInterval(async () => {
  const { lat, lng } = await fetchData();
  if (!prev) { prev={lat,lng}; return; }
  const d = haversine(prev.lat, prev.lng, lat, lng);
  document.getElementById('dist').textContent = (d).toFixed(2)+' m';
  prev = {lat,lng};
}, 3000);

function haversine(lat1,lng1,lat2,lng2){
  const R=6371000;
  const φ1=Math.PI/180*lat1, φ2=Math.PI/180*lat2;
  const Δφ=Math.PI/180*(lat2-lat1), Δλ=Math.PI/180*(lng2-lng1);
  const a=Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}
</script>
</body>
</html>
